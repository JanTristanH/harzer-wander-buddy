<mvc:View
    controllerName="hwb.frontendhwb.controller.RoutesMap"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:dnd="sap.ui.core.dnd"
    xmlns:chart="sap.suite.ui.microchart"
    xmlns:f="sap.f"
    displayBlock="true"
    busyIndicatorDelay="0"
>
    <HBox justifyContent="SpaceBetween">
        <Button
            class="sapUiTinyMargin"
            press='onBackToList'
            type="Transparent"
            text="{i18n>back}"
            icon="sap-icon://navigation-left-arrow"
        />
        <HBox>
            <Button
                class="sapUiTinyMargin"
                text="{i18n>share}"
                icon="sap-icon://share-2"
                type="Transparent"
                press="onButtonShareTourPress"
            />
            <Button
                class="sapUiTinyMargin"
                text="{i18n>edit}"
                icon="sap-icon://edit"
                visible="{= !${local>/edit} }"
                press="onButtonEditPress"
            />
            <Button
                class="sapUiTinyMargin"
                text="{i18n>delete}"
                icon="sap-icon://delete"
                visible="{local>/edit}"
                type="Transparent"
                press="onButtonDeletePress"
            />
            <Button
                class="sapUiTinyMargin"
                text="{i18n>save}"
                icon="sap-icon://save"
                visible="{local>/edit}"
                press="onButtonSavePress"
            />
        </HBox>
    </HBox>
    <Panel
        expandable="true"
        expanded="true"
        width="auto"
        visible="{local>/edit}"
        headerText="{i18n>wayPoints}"
        class="sapUiTinyMargin"
    >
        <Input
            value="{local>/oSelectedTour/name}"
            change="onNameInputChange"
        />
        <Table
            id="idEditRouteTable"
            noDataText="{i18n>noWayPointsPleaseAdd}"
            mode="SingleSelectMaster"
            items="{
            path: 'local>/oSelectedTour/path',
            sorter: {
                path: 'rank',
                descending: true
            }
        }"
        >
            <headerToolbar>
                <OverflowToolbar>
                    <ToolbarSpacer />
                    <Button
                        icon="sap-icon://add"
                        type="Transparent"
                        press="onAddWayPointButtonPress"
                    />
                </OverflowToolbar>
            </headerToolbar>
            <columns>
                <Column visible="false" />
                <Column visible="false" />
                <Column visible="false" />
                <Column width="70%" />
                <Column />
                <Column />
                <Column />
            </columns>
            <dragDropConfig>
                <dnd:DragInfo
                    groupName="selected2available"
                    sourceAggregation="items"
                />
                <dnd:DropInfo
                    groupName="available2selected"
                    targetAggregation="items"
                    dropPosition="Between"
                    drop="onDropSelectedProductsTable"
                />
                <dnd:DragDropInfo
                    sourceAggregation="items"
                    targetAggregation="items"
                    dropPosition="Between"
                    drop="onDropSelectedProductsTable"
                />
            </dragDropConfig>
            <items>
                <ColumnListItem>
                    <cells>
                        <Text
                            text="{local>rank}"
                            visible="true"
                        />
                        <!-- used for easy access in controller -->
                        <Text
                            text="{local>ID}"
                            visible="false"
                        />
                        <!-- used for easy access in controller -->
                        <Text
                            text="{local>toPoi}"
                            visible="false"
                        />
                        <Input
                            class="sapUiSmallMarginTop sapUiSmallMarginBottom"
                            placeholder="{i18n>enterStampOrParking}"
                            showSuggestion="true"
                            suggestionItemSelected="onSuggestionItemSelected"
                            suggestionItems="{
                                path: '/AllPointsOfInterest',
                                sorter: { path: 'orderBy', descending: false }
                            }"
                            value="{local>name}"
                        >
                            <suggestionItems>
                                <core:Item text="{name}">
                                    <core:customData>
                                        <core:CustomData
                                            key="ID"
                                            value="{ID}"
                                        />
                                    </core:customData>
                                </core:Item>
                            </suggestionItems>
                        </Input>
                        <Button
                            icon="sap-icon://up"
                            type="Transparent"
                            press="onUpButtonPress"
                        />
                        <Button
                            icon="sap-icon://down"
                            type="Transparent"
                            press="onDownButtonPress"
                        />
                        <Button
                            icon="sap-icon://delete"
                            type="Transparent"
                            press="onDeleteWayPointButtonPress"
                        />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Panel>
    <l:Splitter
        orientation="Vertical"
        id="idRoutesDetialSplitter"
        resize=".onSplitterRoutesDetailResize"
    >
        <mvc:XMLView
            id="RoutesMapId"
            async="true"
            viewName="hwb.frontendhwb.view.MapInner"
        />
        <VBox>
            <layoutData>
                <l:SplitterLayoutData
                    id="idTourKeyFactsSplitterLayoutData"
                    size="20%"
                />
            </layoutData>
            <FlexBox
                justifyContent="SpaceAround"
                alignItems="Center"
                class="sapUiSmallMarginTop sapUiSmallMarginBottom"
            >
                <VBox
                    alignContent="Center"
                    alignItems="Center"
                    class="sapUiMediumMarginBegin"
                >
                    <core:Icon src="sap-icon://fob-watch" />
                    <Text
                        text="{path: 'local>/oSelectedTour/duration', formatter: '.formatSecondsToTime'}"
                    />
                </VBox>
                <Text text="|" />
                <VBox
                    alignContent="Center"
                    alignItems="Center"
                >
                    <core:Icon src="sap-icon://direction-arrows" />
                    <Text
                        text="{path: 'local>/oSelectedTour/distance', formatter: '.formatMetersToKilometers'}"
                    />
                </VBox>
                <Text text="|" />
                <VBox
                    alignContent="Center"
                    alignItems="Center"
                >
                    <core:Icon src="sap-icon://toaster-top" />
                    <Text text="{local>/oSelectedTour/AverageGroupStampings} / {local>/oSelectedTour/stampCount}" />
                </VBox>
                <Text text="|" />
                <VBox
                    alignContent="Center"
                    alignItems="Center"
                    class="sapUiMediumMarginEnd"
                >
                    <core:Icon src="sap-icon://trend-up" />
                    <Text text="{path: 'local>/oSelectedTour/totalElevationGain', formatter: '.formatCleanMeter'}" />
                </VBox>
            </FlexBox>
            <Panel
                expandable="false"
                expanded="true"
                width="auto"
                headerText="{i18n>wayPoints}"
                class="sapUiTinyMargin"
            >
                <ScrollContainer
                    width="100%"
                    height="{local>/wayPointScrollContainerHeight}"
                    vertical="true"
                    horizontal="false"
                >
                    <List
                        id="idRoutesWayPointList"
                        growingScrollToLoad="true"
                        items="{local>/oSelectedTour/path}"
                        selectionChange="onWaypointListSelectionChange"
                        mode="SingleSelectMaster"
                    >
                        <CustomListItem>
                            <HBox class="sapUiTinyMargin">
                                <FlexBox
                                    alignItems="Center"
                                    justifyContent="Center"
                                >
                                    <core:Icon
                                        src="{path: 'local>travelMode', formatter: '.onFormatTravelModeIcon'}"
                                        color="#758ca4"
                                        class="sapUiSmallMarginEnd size1"
                                    />
                                </FlexBox>
                                <FlexBox
                                    alignItems="Start"
                                    justifyContent="SpaceBetween"
                                    width="100%"
                                >
                                    <VBox
                                        class="sapUiSmallMarginEnd"
                                        justifyContent="Center"
                                    >
                                        <Text
                                            text="{local>name}"
                                            class="sapUiTinyMarginTopBottom sapMTextBold"
                                        />
                                        <Label
                                            text="{parts: [{path: 'local>duration'}, {path: 'local>distance'}], formatter: '.formatDescription'}"
                                            visible="{= !!${local>duration} }"
                                        />
                                        <Label
                                            text="{parts: [{path: 'local>elevationGain'}, {path: 'local>elevationLoss'}], formatter: '.formatElevationDescription'}"
                                            visible="{= !!${local>duration} &amp;&amp; !!${local>maxElevation} }"
                                        />
                                        <chart:AreaMicroChart
                                            size="S"
                                            view="Wide"
                                            width="100%"
                                            minYValue="{local>minElevation}"
                                            visible="{= ${local>travelMode} === 'walk' &amp;&amp; !!${local>maxElevation} }"
                                        >
                                            <chart:lastYLabel>
                                                <chart:AreaMicroChartLabel
                                                    label="{path: 'local>maxElevation', formatter: '.formatCleanMeter'}"
                                                />
                                            </chart:lastYLabel>
                                            <chart:lastXLabel>
                                                <chart:AreaMicroChartLabel
                                                    label="{path: 'local>minElevation', formatter: '.formatCleanMeter'}"
                                                />
                                            </chart:lastXLabel>
                                            <chart:chart>
                                                <chart:AreaMicroChartItem points="{local>elevationProfile}" >
                                                    <chart:points>
                                                        <chart:AreaMicroChartPoint
                                                            x="{local>x}"
                                                            y="{local>y}"
                                                        />
                                                    </chart:points>
                                                </chart:AreaMicroChartItem>
                                            </chart:chart>
                                            <chart:minThreshold>
                                                <chart:AreaMicroChartItem
                                                    color="Good"
                                                    points="{local>elevationProfile}"
                                                >
                                                    <chart:points>
                                                        <chart:AreaMicroChartPoint
                                                            x="{local>x}"
                                                            y="{local>y}"
                                                        />
                                                    </chart:points>
                                                </chart:AreaMicroChartItem>
                                            </chart:minThreshold>
                                        </chart:AreaMicroChart>
                                    </VBox>
                                    <FlexBox
                                        alignItems="Center"
                                        justifyContent="Center"
                                        height="100%"
                                    >
                                        <f:AvatarGroup
                                            id="avatarGroupTravelTime"
                                            groupType="Individual"
                                            avatarDisplaySize="S"
                                            items="{local>stampedUsers}"
                                            press="onAvatarGroupPress"
                                        > 
                                            <f:AvatarGroupItem
                                                initials="{parts: ['local>name'], formatter: '.onFormatInitialsByName'}"
                                                fallbackIcon="sap-icon://person-placeholder"
                                                src="{local>picture}"
                                                tooltip="{local>name}"
                                                fieldGroupIds="{local>ID}"
                                            />
                                        </f:AvatarGroup>
                                    </FlexBox>
                                    <FlexBox
                                        alignItems="Center"
                                        justifyContent="Center"
                                        height="100%"
                                        wrap="NoWrap"
                                    >
                                        <Button
                                            icon="{path: 'local>toPoi', formatter: '.formatStampButtonIcon'}"
                                            visible="{path: 'local>toPoi', formatter: '.formatStampButtonVisible'}"
                                            enabled="{path: 'local>toPoi', formatter: '.formatStampButtonEnabled'}"
                                            type="Transparent"
                                            press="onButtonStampPress"
                                            class="sapUiTinyMarginEnd"
                                        >
                                            <customData>
                                                <core:CustomData
                                                    key="ID"
                                                    value="{local>toPoi}"
                                                    writeToDom="true"
                                                />
                                            </customData>
                                        </Button>

                                        <MenuButton
                                            icon="sap-icon://forward"
                                            type="Emphasized"
                                            buttonMode="Split" 
                                            defaultAction="onNavigateWithGoogleMaps"
                                            class="sapUiTinyMarginEnd"
                                        >
                                            <customData>
                                                <core:CustomData
                                                    key="ID"
                                                    value="{local>toPoi}"
                                                    writeToDom="true"
                                                />
                                            </customData>
                                            <menu>
                                                <Menu itemSelected="onMenuAction">
                                                    <MenuItem text="{i18n>navigate}" icon="sap-icon://forward" press="onNavigateWithGoogleMaps">
                                                        <customData>
                                                            <core:CustomData
                                                                key="ID"
                                                                value="{local>toPoi}"
                                                                writeToDom="true"
                                                            />
                                                        </customData>
                                                    </MenuItem>
                                                    <MenuItem text="{i18n>navigateOtherApp}" icon="sap-icon://map-2">
                                                       <customData>
                                                            <core:CustomData
                                                                key="ID"
                                                                value="{local>toPoi}"
                                                                writeToDom="true"
                                                            />
                                                        </customData>
                                                    </MenuItem>
                                                </Menu>
                                            </menu>
                                        </MenuButton>
                                    </FlexBox>
                                </FlexBox>
                            </HBox>
                        </CustomListItem>
                    </List>
                </ScrollContainer>
            </Panel>
        </VBox>
    </l:Splitter>
</mvc:View>
